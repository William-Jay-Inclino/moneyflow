generator client {
	provider = "prisma-client-js"
}

datasource db {
	provider = "postgresql"
	url      = env("DATABASE_URL")
}

model User {
	id                 String    @id @default(uuid()) @db.Uuid
	email              String    @unique
	password           String
	is_active          Boolean   @default(true)
	email_verified     Boolean   @default(false)
	email_verify_token String?   @unique
	registered_at      DateTime  @default(now()) @db.Timestamptz

	// Relations
	user_categories UserCategory[]
	user_expenses   UserExpense[]
	user_income     UserIncome[]

	@@index([is_active])
	@@index([registered_at])
	@@index([email_verified])
	@@map("users")
}

model Category {
	id         Int          @id @default(autoincrement())
	name       String
	type       CategoryType
	color      String
	icon       String
	is_default Boolean      @default(false)

	// Relations
	user_categories UserCategory[]

	@@map("categories")
}

enum CategoryType {
	INCOME
	EXPENSE
}

model UserCategory {
	id          Int          @id @default(autoincrement())
	user_id     String       @db.Uuid
	category_id Int?

	// Relations
	user          User          @relation(fields: [user_id], references: [id], onDelete: Cascade)
	category      Category?     @relation(fields: [category_id], references: [id], onDelete: SetNull)
	user_expenses UserExpense[]
	user_income   UserIncome[]

	@@index([user_id])
	@@map("user_categories")
}

model UserExpense {
	id           String   @id @default(uuid()) @db.Uuid
	user_id      String   @db.Uuid
	created_at   DateTime @default(now()) @db.Timestamptz
	expense_date DateTime @db.Timestamptz
	category_id  Int
	cost         Decimal  @db.Decimal(10, 2)
	notes        String?

	// Relations
	user     User         @relation(fields: [user_id], references: [id], onDelete: Cascade)
	category UserCategory @relation(fields: [category_id], references: [id], onDelete: Restrict)

	@@index([user_id])
	@@index([user_id, expense_date])
	@@map("user_expenses")
}

model UserIncome {
	id          String   @id @default(uuid()) @db.Uuid
	user_id     String   @db.Uuid
	created_at  DateTime @default(now()) @db.Timestamptz
	income_date DateTime @db.Timestamptz
	category_id Int
	amount      Decimal  @db.Decimal(10, 2)
	notes       String?

	// Relations
	user     User         @relation(fields: [user_id], references: [id], onDelete: Cascade)
	category UserCategory @relation(fields: [category_id], references: [id], onDelete: Restrict)

	@@index([user_id])
	@@index([user_id, income_date])
	@@map("user_income")
}


